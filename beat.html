<!DOCTYPE html>
<!--
    Beat Frequency Physics Simulation
    Originally created for physics courses at Tacoma Community College
    Author: David Anderson
    Use and distribute freely
-->
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Beat Frequency Simulation</title>
        <link rel="stylesheet" href="beatstyle.css">
    </head>

    <body>

        <div class="frequency-div">

            <div>
                <label for="frequencyA">Frequency 1:</label>
                <select name="Frequency A" id="frequencyA" onchange="chooseSrc()"></select>
            </div>

            <div>
                <input type="image" src="images/speaker.png" class="speaker-image"  alt="Speaker" onclick="playAudio()">

                <audio controls controlsList="nodownload" id="beat">
                    <source id="beatFile" src="">
                    Error: browser does not support audio
                </audio>
                <br>
            </div>

            <div>
                <label for="frequencyB">Frequency 2:</label>
                <select name="Frequency B" id="frequencyB" onchange="chooseSrc()" class="frequency2-select"></select>
            </div>
        </div>

        <div class="instructions-div">
            <h3>Instructions for running the simulation:</h3>
            <ol>
                <li>Select a first frequency from the Frequency 1 options list.</li>
                <li>Select a second frequency from the Frequency 2 options list.</li>
                <li>Click the play button or the speaker icon to start audio playback.</li>
            </ol>
        </div>


        <script type="application/javascript">
            let frequencyA = document.getElementById("frequencyA");
            let frequencyB = document.getElementById("frequencyB");
            let audio = document.getElementById("beat");
            let source = document.getElementById("beatFile");

            let frequencies = {"500": 500, "501": 501, "502": 502, "503": 503, "504": 504,
                "A": 499, "B": 501.5, "C": 506, "D": 509};

            function loadFrequencies(select, skip = 0){
                for(let frequency in frequencies){
                    if(frequencies[frequency] === skip){
                        continue;
                    }
                    let option = document.createElement("option");
                    let optionText = frequency;
                    if(!isNaN(+frequency)){
                        optionText = optionText + " hz";
                    }
                    option.textContent = optionText;
                    option.value = frequencies[frequency];
                    select.appendChild(option);
                }
            }

            loadFrequencies(frequencyA);
            loadFrequencies(frequencyB);

            function chooseSrc() {
                let hzA = parseFloat(frequencyA.value);
                let hzB = parseFloat(frequencyB.value);

                if(hzA > hzB) {
                    let temp = hzA;
                    hzA = hzB;
                    hzB = temp;
                }

                // remove decimal point from a floating point hz value to avoid illegal dot in filename
                function removeDecimal(num){
                    if(num % 1 !== 0){
                        let decimal = num % 1;
                        return "" + Math.floor(num) + Math.floor(decimal * 10);
                    }
                    else{
                        return "" + num;
                    }
                }

                source.src = "audio/" + removeDecimal(hzA) + "-" + removeDecimal(hzB) + ".mp3";

                console.log(source.src);
                audio.load();
            }

            function playAudio(){
                if(audio.paused){
                    audio.play();
                }
                else{
                    audio.pause();
                }
            }
        </script>
    </body>
</html>